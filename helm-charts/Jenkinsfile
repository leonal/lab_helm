@Library('piper-lib-os') _
node() {

    stage('prepare') {
        checkout scm
        setupCommonPipelineEnvironment script:this
    }

    stage("Lint") {
        helmExecute script: this, helmCommand: 'lint'
    }

    stage("Publish") {
        helmExecute script: this, helmCommand: 'publish', packageDependencyUpdate: true, chartPath: 'helm-charts/charts/nginx'
        /*, targetRepositoryName: 'lab_chart_repo', targetRepositoryURL: 'https://leonal.github.io/lab_chart_repo/'*/
    }
    
    stage("Install & Test") {
        /*helmExecute script: this, helmCommand: 'dependency', dependency: 'update', chartPath: 'helm-charts/charts/nginx'*/
        helmExecute script: this, helmCommand: 'install', chartPath: 'helm-charts/charts/nginx', targetRepositoryName: 'lab_chart_repo'
        helmExecute script: this, helmCommand: 'test'
        helmExecute script: this, helmCommand: 'uninstall'
    }

    stage("Package Charts") {
        /* kubernetesDeploy script: this */
        /* kubernetesDeploy script: this, deployTool: 'helm3', chartPath: 'myChart', deploymentName: 'myRelease', image: 'nginx', containerRegistryUrl: 'https://docker.io' */

    }

    stage("Push Charts to Chart Repo") {

    }

}
